(function(){TBTouch.TMS={writing:{COMMON_AJAX_ERR:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5",},slide:function(){return{init:function(){},}}(),shortcuts:function(){var a=function(b,c){c.preventDefault();if(b.hasClass("shortcuts")){$("#J_IndexTab .shortcuts_content").removeClass("none");$(".grid-c div.module").addClass("none")}else{$("#J_IndexTab .shortcuts_content").addClass("none");$(".grid-c div.module").removeClass("none")}$(".grid-c .header").removeClass("none");$(".grid-c .mix-widget-tab-v2").removeClass("none");$(".grid-c .footer").removeClass("none");b.parent("li").siblings("li").removeClass("current");b.parent("li").addClass("current")};if($("#J_IndexTab .common-tab-v2 li").eq(0).attr("data-index")==1){$("#J_IndexTab .common-tab-v2 li a").unbind("click").bind("click",function(c){var b=$(this);if(!b.hasClass("downloads")){a(b,c)}})}else{$("#J_IndexTab .common-tab-v2 li a").unbind("click").bind("click",function(c){var b=$(this);if(!b.hasClass("home")){a(b,c)}})}},convenience:function(){$(".mix-widget-convenience-v2 ul li").unbind("click").bind("click",function(){if(!$(this).hasClass("cur")){var a=$(".mix-widget-convenience-v2 ul li").index($(this));var b=$(".mix-widget-convenience-v2 .normal-content div").eq(a);b.removeClass("none");b.siblings().addClass("none");$(this).addClass("cur");$(this).siblings("li").removeClass("cur")}})},backTotop:function(a){$(a).click(function(){$("html,body").animate({scrollTop:0},200);return false})},paramSidTtid:function(b){var e=$(".logo").find("a").attr("href");var g=e.indexOf("sid=")>-1?e.match(/sid=\w*/)[0]:"";var d=e.indexOf("ttid=")>-1?e.match(/ttid=\w*/)[0]:"";if(b.indexOf("?")>0){if(!g==""){var f="&"+g}else{f=0}if(!d==""){var c="&"+d}else{c=0}}else{if(g==""&&d!=""){var f=0;var c="?"+d}else{if(g!=""&&d==""){var f="?"+g;var c=0}else{if(g!=""&&d!=""){var f="?"+g;var c="&"+d}}}}var a=[];a[0]=f;a[1]=c;return a},getTabContent:function(){var e=false;var a=function(i,j,h,g){var f=window.location.href.substring(0,window.location.href.indexOf("."));j=f+j.substring(j.indexOf("."));$.ajax({url:j,type:"get",dataType:"json",data:"",error:function(){if(e){console.log("\u8fdb\u5165\u53cb\u597d\u63d0\u793a\uff1a\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5")}else{alert("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5")}e=true},success:function(k){h.attr("isloaded","1");d.remove(i);if(k.index[0]!=undefined){i.addClass("more")}c(i,k,g)}})};var d={add:function(g){var f="";f+='<div class="loading"><img width="30" height="30" src="http://a.tbcdn.cn/mw/s/hi/tbtouch/images/loading.gif" /></div>';g.html(f)},remove:function(f){f.html("")}};var c=function(m,j,l){var o=j.links;var g="";var f="";if(j.object[0]!=undefined){var n=TBTouch.TMS.paramSidTtid(j.object[0].url)[0];var k=TBTouch.TMS.paramSidTtid(j.object[0].url)[1];g+='<div class="common-item">';g+='<a href="'+j.object[0].url+n+k+'">';g+='<div class="p">';g+='<img src="'+j.object[0].pic+'" width="80" height="80" alt="" />';g+="</div>";g+='<div class="d">';g+="<h3>"+j.object[0].title+"</h3>";g+="<p>"+j.object[0].desc+"</p>";g+="</div>";g+="</a>";g+="</div>"}g+='<ul class="links">';for(var h=0;h<j.links.length;h++){var n=TBTouch.TMS.paramSidTtid(o[h].url)[0];var k=TBTouch.TMS.paramSidTtid(o[h].url)[1];g+='<li><span></span><a href="'+o[h].url+n+k+'">'+o[h].txt+"</a></li>"}g+="</ul>";if(j.index[0]!=undefined){var n=TBTouch.TMS.paramSidTtid(j.index[0].url)[0];var k=TBTouch.TMS.paramSidTtid(j.index[0].url)[1];g+='<div class="more">';g+='<a href="'+j.index[0].url+n+k+'">\u8fdb\u5165<em>'+j.index[0].cat+"</em>\u9891\u9053</a>";g+="</div>"}f+='<div class="J_TabContent_'+l+'">';f+=g;f+="</div>";m.html(g);m.siblings(".none").append(f)};var b=function(i,g){var f=".none .J_TabContent_"+g;var h=$(i).find(f).html();$(i).find(".normal-content").html(h)};return{init:function(f){TBTouch.TMS.getTabContent.fire(f);d.add($(f).find(".normal-content"));$(f).find(".option li.cur").removeClass("cur").click()},fire:function(f){$(f).find(".option li").unbind("click").bind("click",function(){var g=$(f).find(".option li").index($(this));if(!$(this).hasClass("cur")&&$(this).attr("isloaded")==0){d.add($(f).find(".normal-content"));var h=$(this).attr("url");$(this).addClass("cur");$(this).siblings("li").removeClass("cur");a($(f).find(".normal-content"),h,$(this),g)}else{if(!$(this).hasClass("cur")&&$(this).attr("isloaded")==1){$(this).addClass("cur");$(this).siblings("li").removeClass("cur");b(f,g)}}})},move:function(f){$(f).find(".option li").unbind("click")}}}(),lazyload:function(){window.jQuery&&jQuery(function(b){if(b("img.lazy").length==0){return}function a(e){var f=window.pageYOffset;var d=window.pageYOffset+window.innerHeight;var c=b(e).offset().top;return c>=f&&c<=d}b(window).bind("scroll",function(){b("img.lazy").each(function(){var e=b(this);if(!a(this)){return}var c=new Image(),d=e.attr("data-original");c.onload=function(){e.attr("src",d).removeClass("lazy").css({opacity:0.2}).animate({opacity:1},280)};d&&(c.src=d)})}).trigger("scroll")})}};TBTouch.TMS.lazyload();$.fn.imageRoller=function(a){var b={width:269,slideEl:"ul",childEl:"li",operator:".operator",left:".prev",right:".next",current:".current",total:".total"};if(a){$.extend(b,a)}return jQuery(this).each(function(){var f=1,d=Math.ceil($(this).find(b.childEl).length),c=$(this).find(b.slideEl),e=$(this).find(b.current);$(this).find(b.total).append(d);if(d!=1){$(this).find(b.left).click(function(){if(f!=1){c.animate({left:-(b.width*(f-2))},1000);f--}else{if(f==1){c.animate({left:-(b.width*(d-1))},1000);f=d}}this.blur();e.empty();e.append(f);return false});$(this).find(b.right).click(function(){if(d!=f){c.animate({left:-(b.width*f)},1000);f++}else{if(f==d){c.animate({left:0},1000);f=1}}this.blur();e.empty();e.append(f);return false})}else{$(this).find(b.operator).hide()}})};$.fn.expandLayer=function(a){var b={operator:".cat-list > li",inner:".txt-list-brand",expand:"cur",anim:true};if(a){$.extend(b,a)}return $(this).each(function(){$(this).find(b.operator).click(function(){if($(this).hasClass(b.expand)){var c=$(this);if(b.anim){if(c.next().hasClass(b.inner)){c.next(b.inner).slideUp("normal",function(){c.removeClass(b.expand)})}}}else{var c=$(b.operator).filter("."+b.expand);if(c.next().hasClass(b.inner)){c.next(b.inner).slideUp("normal",function(){c.removeClass(b.expand)})}if(b.anim){if($(this).next().hasClass(b.inner)){$(this).addClass(b.expand);$(this).next(b.inner).slideDown("normal")}}}return false})})};$.waterfall=function(f){var t={container:"#ColumnContainer",ajaxUrl:"http://m.taobao.com/go/rgn/mobile/waterfall2.html"};if(f){$.extend(t,f)}var p=$(t.container),m=p.width(),b=p.offset().top;var o=0,h=0,u=0,y=95,s=3,r=[];r.length=Math.max(parseInt(m/y),s);for(var w=0;w<r.length;w++){r[w]=0}function l(){jQuery.ajax({url:t.ajaxUrl,type:"get",dataType:"script",data:"",error:function(){alert("error")},success:function(z){if(o>=json.pages){g();return}var i=0;var A=json.imgs[json.pages-o-1];if(A.length>0){setTimeout(function(){v(A[i]);i++;if(i<A.length){setTimeout(arguments.callee,25)}else{h=0;o++;p.height(Math.max.apply(Math,r));$(".loading").hide()}},25)}}})}function g(){$(window).unbind("scroll");$(".loading").hide();$(".lastPage").html("\u4eb2\uff0c\u5df2\u7ecf\u5230\u5e95\u4e86\u54e6\uff01")}function v(A){var B=TBTouch.TMS.paramSidTtid(A.href)[0];var z=TBTouch.TMS.paramSidTtid(A.href)[1];var i="";i+='<div class="waterfall">';i+='<a href="'+A.href+B+z+'">';i+='<img alt="'+A.title+'" src="'+A.img+'" height='+A.height+" />";if(A.price){i+="<span>&yen; "+A.price+"&nbsp;</span>"}i+="</a>";i+="</div>";n(i,A.height)}function n(G,z){var E=$(G),B=r.length,A=0,D=Number.MAX_VALUE;for(var C=0;C<B;C++){if(r[C]<D){D=r[C];A=C}}if(!B){D=0}var F=Math.max(m-B*y,0)/(B+1);E.css({left:A*y+(A+1)*F,top:D});E.fadeIn("slow");p.append(E);if(z){E.height(z+"px")}else{E.height("95px")}r[A]+=E.height()+10;return E}function j(){console.log("start scroll!");if(h){return}if(u){return}var A=0;if(r.length){A+=Math.min.apply(Math,r)}console.log("window.scrollY: "+window.scrollY);console.log("window.innerHeight: "+window.innerHeight);console.log("height1: "+(window.scrollY+window.innerHeight));console.log("height2: "+(A+p.offset().top));var z=Math.max(window.scrollY,$(window).scrollTop());var i=Math.max(window.innerHeight,$(window).height());if((z+i)>=(A+p.offset().top)){console.log("scroll!");$(".loading").show();h=1;l()}}function a(){if(p.width()===m){return}var i=p.find(".waterfall");if(u){x.stop(i,u)}c(i);x.start(i)}function c(i){m=p.width();r=[];r.length=Math.max(parseInt(m/y),s);$.each(r,function(z){r[z]=0});i=p.find(".waterfall")}var x={start:function(i){var z=0;if(i.length>0){u=setTimeout(function(){n(i[z],$(i[z]).height());z++;if(z<i.length){u=setTimeout(arguments.callee,25)}else{u=0;p.height(Math.max.apply(Math,r))}},25)}},stop:function(i,z){if(z){clearTimeout(z);i={}}}};h=1;l();var k=function(){setTimeout(j,50)};$(window).bind("scroll",k);var e=function(){setTimeout(a,50)};$(window).bind("resize",e);var d="onorientationchange" in window,q=d?"orientationchange":"resize";$(window).bind(q,function(){switch(window.orientation){case 0:case 180:case 90:e();break;case -90:e();break}})};$.fn.smallPicTouch=function(a){var b={smallwrap:".cc-smalldiv",smallwrapcont:".cc-smallwrap",childTag:"li",margin:0,prev:".cc-prev",next:".cc-next",timer:300};if(a){$.extend(b,a)}return $(this).each(function(){var c=$(this),e=$(b.smallwrap),q=e.width(),h=c.find(b.prev),m=c.find(b.next),k=c.find(b.smallwrapcont),p=k.find(b.childTag),n=p.length,g=p.eq(0).width()+b.margin,d=g*n-b.margin*1,j=0,f=n-Math.ceil(q/g),s=0;if(f<=0){return}k.width(d);k[0].onmousedown=k[0].ontouchstart=i;function r(t){return t.changedTouches?t.changedTouches[0].clientX:t.clientX}function i(w){var u=k.position().left,v=r(w),t,B,A,z;k[0].onmousemove=k[0].ontouchmove=y;k[0].ontouchend=document.onmouseup=x;function y(C){C.preventDefault();t=r(C);A=t-v;z=A+u;if(z<0&&z>(q-d)){k.css("left",z)}}function x(E){E.preventDefault();B=r(E);var D=B-v,C=D<0?-1:1;stepn=Math.ceil(Math.abs(D)/g);if(C<0){s+=stepn;o(1)}else{s-=stepn;l(1)}k[0].ontouchmove=k[0].ontouchend=k[0].onmousemove=document.onmouseup=null}}h.bind("click",l);m.bind("click",o);function l(t){if(s>j){if(typeof t!="number"){s-=1}}else{s=0}k.animate({left:-(g*s)},b.timer,function(){k.css("left",-g*s)})}function o(t){if(s<f){if(typeof t!="number"){s+=1}}else{s=f}k.animate({left:-(g*s)},b.timer,function(){k.css("left",-g*s)})}})}})();