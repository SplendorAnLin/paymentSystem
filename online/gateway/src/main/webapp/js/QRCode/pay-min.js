(function(){var utils={find:function(selector){return document.body.querySelector(selector)},findAll:function(selector){return document.body.querySelectorAll(selector)},alert:function(msg,outTime){var alertBox=utils.find(".alert");var alertMsg=utils.find(".alert-msg");var activeClass="active";outTime=outTime||1500;alertMsg.innerHTML=msg;alertBox.classList.add(activeClass);setTimeout(function(){alertBox.classList.remove(activeClass)},outTime)},loadAnimate:function(show,delay){var element=utils.find(".fullpage");var activeClass="active";if(show){if(delay){setTimeout(function(){element.classList.add(activeClass)},delay)}else{element.classList.add(activeClass)}}else{element.classList.remove(activeClass)}},submit:function(time){var submitKey=utils.find("#to-submit");submitKey.classList.add("disable");utils.loadAnimate(true,time);setTimeout(function(){submitKey.classList.remove("disable")},1500)},revoked:function(){var submitKey=utils.find("#to-submit");submitKey.classList.remove("disable");utils.loadAnimate(false)},ajax:function(opt){opt=opt||{};opt.method=opt.method.toUpperCase()||"POST";opt.url=opt.url||"";opt.async=opt.async||true;opt.data=opt.data||null;opt.success=opt.success||function(){};opt.error=opt.error||function(){};var xmlHttp=null;if(XMLHttpRequest){xmlHttp=new XMLHttpRequest()}else{xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}var params=[];for(var key in opt.data){params.push(key+"="+opt.data[key])}var postData=params.join("&");if(opt.method.toUpperCase()==="POST"){xmlHttp.open(opt.method,opt.url,opt.async);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");xmlHttp.send(postData)}else{if(opt.method.toUpperCase()==="GET"){xmlHttp.open(opt.method,opt.url+"?"+postData,opt.async);xmlHttp.send(null)}}xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){if(xmlHttp.status==200){opt.success(xmlHttp.responseText)}else{opt.error(xmlHttp)}}}},serialize:function(form){var arr={};for(var i=0;i<form.elements.length;i++){var feled=form.elements[i];switch(feled.type){case undefined:case"button":case"file":case"reset":case"submit":break;case"checkbox":case"radio":if(!feled.checked){break}default:if(arr[feled.name]){arr[feled.name]=arr[feled.name]+","+feled.value}else{arr[feled.name]=feled.value}}}return arr},};window.utils=utils})();(function(){var amountInput=utils.find("#amount");var showAmountDiv=utils.find("#unit_holder .amount");var submitKey=utils.find("#to-submit");var keyboard={boardBox:null,init:function(boardBox){amountInput.value=0;boardBox.classList.add("open");keyboard.boardBox=boardBox;keyboard.bind()},bind:function(){var boardBox=keyboard.boardBox;boardBox.addEventListener("touchstart",function(event){if(event.target==boardBox){return}var key=keyboard.findKey(event.target);var code=key.getAttribute("data-code");if(code==undefined){return}key.classList.add("down");keyboard.setAmount(code)});boardBox.addEventListener("touchend",function(event){if(event.target==boardBox){return}var key=keyboard.findKey(event.target);key.classList.remove("down")});submitKey.addEventListener("click",function(){keyboard.appendZero()})},findKey:function(key){var current=key;if(!key.classList.contains("key")){current=key.parentNode}return current},setAmount:function(code){var amount=showAmountDiv.innerHTML;switch(code){case"clear":amount="";break;case"backspace":amount=keyboard.popAmount(amount);break;case".":if(amount==""){amount="0."}else{if(keyboard.findDot(amount)==-1&&amount.length>=1){amount=amount+"."}}break;default:if(keyboard.testDotBit(amount)){amount=keyboard.spliceAmount(amount,code)}break}var realAmount=parseFloat(amount);if(realAmount>50000){utils.alert("超过可支付最大金额:50000");return}if(amount==""){realAmount=0}amount=keyboard.removePrefix(amount);if(realAmount>0){submitKey.classList.remove("disable")}else{submitKey.classList.add("disable")}amountInput.value=realAmount;showAmountDiv.innerHTML=amount},removePrefix:function(amount){if(parseFloat(amount)=="0"){return amount.replace(/[0]+/g,"0")}else{if(/0\./.test(amount)){return amount.replace(/[0]+/g,"0")}else{if(parseFloat(amount)>0){var dotIndex=keyboard.findDot(amount);if(dotIndex!==-1){var prev=amount.slice(0,dotIndex+1);var next=amount.slice(dotIndex+1);return prev.replace(/[0]+/g,"")+next}return amount.replace(/^[0]+/g,"")}}}return amount},popAmount:function(amount){var strAmount=String(amount);strAmount=strAmount.slice(0,strAmount.length-1);return strAmount},findDot:function(amount){return amount.indexOf(".")},spliceAmount:function(amount,nextAmount){var amount=String(amount);var nextAmount=String(nextAmount);return amount+nextAmount},appendZero:function(){var amount=showAmountDiv.innerHTML;if(amount.slice(amount.length-1)=="."){showAmountDiv.innerHTML=amount+"0"}},testDotBit:function(amount){var dotIndex=keyboard.findDot(amount);if(dotIndex!==-1){if(amount.slice(dotIndex).length>2){return false}}return true},};window.keyboard=keyboard})();window.onload=function(){window.keyboard.init(utils.find(".keyboard"))
};